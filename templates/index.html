<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShiroBurn</title>
    
    <!-- Google AdSense ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9604512601494581"
            crossorigin="anonymous"></script>
    
    <!-- Chart.js ì¶”ê°€ (ê·¸ë˜í”„ìš©) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        async function fetchBurnData() {
            try {
                // ì´ ì†Œê°ëŸ‰ ê°€ì ¸ì˜¤ê¸°
                const responseBurned = await fetch("https://burn-tracker.onrender.com/api/burned");
                const dataBurned = await responseBurned.json();
                console.log("ğŸ”¥ API ì‘ë‹µ ë°ì´í„°:", dataBurned); // ë””ë²„ê¹…ìš©

                if (dataBurned && dataBurned.total_burned !== undefined) {
                    document.getElementById("burnedAmount").textContent = dataBurned.total_burned.toFixed(2) + " $SHIRO";
                    // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                    updateChart(dataBurned.total_burned); // total_burned ì „ë‹¬
                }else {
                    document.getElementById("burnedAmount").textContent = "ë°ì´í„° ì˜¤ë¥˜";
                }

                // Burn Rate ê°€ì ¸ì˜¤ê¸°
                const responseRate = await fetch("https://burn-tracker.onrender.com/api/burn-rate");
                const dataRate = await responseRate.json();

                if (dataRate && dataRate.burn_rate !== undefined) {
                    document.getElementById("burnRate").textContent = dataRate.burn_rate.toFixed(2) + "% ğŸ¢";
                } else {
                    document.getElementById("burnRate").textContent = "ë°ì´í„° ì˜¤ë¥˜";
                }

                if (dataRate && dataRate.burn_amount_24h !== undefined) {
                    document.getElementById("burnAmount24h").textContent = `Last 24hrs (${dataRate.burn_amount_24h.toLocaleString()} $SHIRO)`;
                } else {
                    document.getElementById("burnAmount24h").textContent = "ë°ì´í„° ì˜¤ë¥˜";
                }

                // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸
                updateChart(dataRate.burn_amount_24h);
            } catch (error) {
                console.error("âŒ Error fetching burn data:", error);
            }
        }

        function updateChart(burnAmount) {
            const maxDataPoints = 24; // ì˜ˆ: 24ì‹œê°„ ë°ì´í„°ë¥¼ í‘œì‹œ

            // ë°ì´í„° ì¶”ê°€
            burnChart.data.datasets[0].data.push(totalBurned);
            burnChart.data.labels.push(new Date().toLocaleTimeString());

            // ë°ì´í„° í¬ì¸íŠ¸ê°€ 24ê°œë¥¼ ë„˜ìœ¼ë©´ ì²« ë²ˆì§¸ ë°ì´í„°ë¥¼ ì‚­ì œ
            if (burnChart.data.datasets[0].data.length > maxDataPoints) {
                burnChart.data.datasets[0].data.shift();
                burnChart.data.labels.shift();
            }

            burnChart.update();
        }

        var burnChart;

        window.onload = function() {
            // ê·¸ë˜í”„ ê°ì²´ ìƒì„±
            var ctx = document.getElementById('burnRateChart').getContext('2d');
            burnChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Burn Amount (Last 24h)',
                        data: [],
                        borderColor: 'red',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    scales: {
                        x: {
                            title: { display: true, text: 'Time' }
                        },
                        y: {
                            title: { display: true, text: 'Burn Amount' }
                        }
                    }
                }
            });

            // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            fetchBurnData();

            // ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œë¥¼ 3ì´ˆ ì§€ì—°í•˜ì—¬ ì‹¤í–‰
            setTimeout(function() {
                console.log("ğŸ“¢ Google AdSense ê´‘ê³  ë¡œë“œ ì‹œì‘");
                (adsbygoogle = window.adsbygoogle || []).push({});
            }, 3000);
        };
    </script>
</head>
<body>
    <h1>ğŸ”¥ $Shiro Neko Supply ğŸ”¥</h1>
    <p>Total burnt from initial supply: <span id="burnedAmount">Loading...</span></p>
    <p>Burn Rate: <span id="burnRate">Loading...</span></p>
    <p><span id="burnAmount24h"></span></p>

    <!-- Burn Rate ê·¸ë˜í”„ -->
    <canvas id="burnRateChart" width="400" height="200"></canvas>

    <!-- Google AdSense ê´‘ê³  (í˜ì´ì§€ ìƒë‹¨) -->
    <div style="text-align: center; margin: 20px 0;">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="pub-9604512601494581"
             data-ad-slot="5372001330"
             data-ad-format="auto"></ins>
    </div>

    <!-- ì¶”ê°€ ê´‘ê³  ì˜ì—­ (í•˜ë‹¨ ë°°ë„ˆ) -->
    <div style="text-align: center; margin: 40px 0;">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="pub-9604512601494581"
             data-ad-slot="5372001330"
             data-ad-format="horizontal"></ins>
    </div>
</body>
</html>
